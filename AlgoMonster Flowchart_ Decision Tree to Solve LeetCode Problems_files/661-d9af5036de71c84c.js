(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[661],{51852:function(e,t,r){"use strict";r.d(t,{Z:function(){return _}});var a=r(94184),n=r.n(a),o=r(67294),s=r(47150),i=r(78146),l=r(76792),c=r(39602),u=r(85893);const p=(0,c.Z)("h4");p.displayName="DivStyledAsH4";const d=o.forwardRef((({className:e,bsPrefix:t,as:r=p,...a},o)=>(t=(0,l.vE)(t,"alert-heading"),(0,u.jsx)(r,{ref:o,className:n()(e,t),...a}))));d.displayName="AlertHeading";var f=d,g=r(24079);const h=o.forwardRef((({className:e,bsPrefix:t,as:r=g.Z,...a},o)=>(t=(0,l.vE)(t,"alert-link"),(0,u.jsx)(r,{ref:o,className:n()(e,t),...a}))));h.displayName="AlertLink";var m=h,y=r(41068),v=r(41485);const E=o.forwardRef(((e,t)=>{const{bsPrefix:r,show:a=!0,closeLabel:o="Close alert",closeVariant:c,className:p,children:d,variant:f="primary",onClose:g,dismissible:h,transition:m=y.Z,...E}=(0,s.Ch)(e,{show:"onClose"}),_=(0,l.vE)(r,"alert"),b=(0,i.Z)((e=>{g&&g(!1,e)})),I=!0===m?y.Z:m,w=(0,u.jsxs)("div",{role:"alert",...I?void 0:E,ref:t,className:n()(p,_,f&&`${_}-${f}`,h&&`${_}-dismissible`),children:[h&&(0,u.jsx)(v.Z,{onClick:b,"aria-label":o,variant:c}),d]});return I?(0,u.jsx)(I,{unmountOnExit:!0,...E,ref:void 0,in:a,children:w}):a?w:null}));E.displayName="Alert";var _=Object.assign(E,{Link:m,Heading:f})},58833:function(e,t,r){"use strict";var a=r(48764).Buffer;const n="undefined"!==typeof a,o=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,s=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function i(e,t,r){null==r&&null!==t&&"object"===typeof t&&(r=t,t=void 0),n&&a.isBuffer(e)&&(e=e.toString()),e&&65279===e.charCodeAt(0)&&(e=e.slice(1));const i=JSON.parse(e,t);if(null===i||"object"!==typeof i)return i;const c=r&&r.protoAction||"error",u=r&&r.constructorAction||"error";if("ignore"===c&&"ignore"===u)return i;if("ignore"!==c&&"ignore"!==u){if(!1===o.test(e)&&!1===s.test(e))return i}else if("ignore"!==c&&"ignore"===u){if(!1===o.test(e))return i}else if(!1===s.test(e))return i;return l(i,{protoAction:c,constructorAction:u,safe:r&&r.safe})}function l(e,{protoAction:t="error",constructorAction:r="error",safe:a}={}){let n=[e];for(;n.length;){const e=n;n=[];for(const o of e){if("ignore"!==t&&Object.prototype.hasOwnProperty.call(o,"__proto__")){if(!0===a)return null;if("error"===t)throw new SyntaxError("Object contains forbidden prototype property");delete o.__proto__}if("ignore"!==r&&Object.prototype.hasOwnProperty.call(o,"constructor")&&Object.prototype.hasOwnProperty.call(o.constructor,"prototype")){if(!0===a)return null;if("error"===r)throw new SyntaxError("Object contains forbidden prototype property");delete o.constructor}for(const e in o){const t=o[e];t&&"object"===typeof t&&n.push(t)}}}return e}function c(e,t,r){const a=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return i(e,t,r)}finally{Error.stackTraceLimit=a}}e.exports=c,e.exports.default=c,e.exports.parse=c,e.exports.safeParse=function(e,t){const r=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return i(e,t,{safe:!0})}catch(a){return null}finally{Error.stackTraceLimit=r}},e.exports.scan=l},62838:function(e,t,r){"use strict";var a=r(67294);var n="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},o=a.useState,s=a.useEffect,i=a.useLayoutEffect,l=a.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!n(e,r)}catch(a){return!0}}var u="undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),a=o({inst:{value:r,getSnapshot:t}}),n=a[0].inst,u=a[1];return i((function(){n.value=r,n.getSnapshot=t,c(n)&&u({inst:n})}),[e,r,t]),s((function(){return c(n)&&u({inst:n}),e((function(){c(n)&&u({inst:n})}))}),[e]),l(r),r};t.useSyncExternalStore=void 0!==a.useSyncExternalStore?a.useSyncExternalStore:u},98557:function(e,t,r){"use strict";e.exports=r(62838)},49623:function(e){e.exports=function(e,t){if("function"!==typeof e)throw new TypeError(`Expected the first argument to be a \`function\`, got \`${typeof e}\`.`);let r,a=0;return function(...n){clearTimeout(r);const o=Date.now(),s=t-(o-a);s<=0?(a=o,e.apply(this,n)):r=setTimeout((()=>{a=Date.now(),e.apply(this,n)}),s)}}},50268:function(e,t,r){"use strict";r.d(t,{RJ:function(){return Ft}});var a,n=r(67294),o="vercel.ai.error",s=Symbol.for(o),i=class e extends Error{constructor({name:e,message:t,cause:r}){super(t),this[a]=!0,this.name=e,this.cause=r}static isInstance(t){return e.hasMarker(t,o)}static hasMarker(e,t){const r=Symbol.for(t);return null!=e&&"object"===typeof e&&r in e&&"boolean"===typeof e[r]&&!0===e[r]}};a=s;var l=i,c="AI_APICallError",u=`vercel.ai.error.${c}`,p=Symbol.for(u);var d="AI_EmptyResponseBodyError",f=`vercel.ai.error.${d}`,g=Symbol.for(f);function h(e){return null==e?"unknown error":"string"===typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}var m,y="AI_InvalidArgumentError",v=`vercel.ai.error.${y}`,E=Symbol.for(v),_=class extends l{constructor({message:e,cause:t,argument:r}){super({name:y,message:e,cause:t}),this[m]=!0,this.argument=r}static isInstance(e){return l.hasMarker(e,v)}};m=E;var b="AI_InvalidPromptError",I=`vercel.ai.error.${b}`,w=Symbol.for(I);var T="AI_InvalidResponseDataError",S=`vercel.ai.error.${T}`,R=Symbol.for(S);var A,k="AI_JSONParseError",C=`vercel.ai.error.${k}`,x=Symbol.for(C),N=class extends l{constructor({text:e,cause:t}){super({name:k,message:`JSON parsing failed: Text: ${e}.\nError message: ${h(t)}`,cause:t}),this[A]=!0,this.text=e}static isInstance(e){return l.hasMarker(e,C)}};A=x;var O="AI_LoadAPIKeyError",D=`vercel.ai.error.${O}`,j=Symbol.for(D);var F="AI_LoadSettingError",P=`vercel.ai.error.${F}`,L=Symbol.for(P);var M="AI_NoContentGeneratedError",V=`vercel.ai.error.${M}`,$=Symbol.for(V);var B="AI_NoSuchModelError",J=`vercel.ai.error.${B}`,U=Symbol.for(J);var Y="AI_TooManyEmbeddingValuesForCallError",W=`vercel.ai.error.${Y}`,q=Symbol.for(W);var K,G="AI_TypeValidationError",Z=`vercel.ai.error.${G}`,H=Symbol.for(Z);K=H;var z=class e extends l{constructor({value:e,cause:t}){super({name:G,message:`Type validation failed: Value: ${JSON.stringify(e)}.\nError message: ${h(t)}`,cause:t}),this[K]=!0,this.value=e}static isInstance(e){return l.hasMarker(e,Z)}static wrap({value:t,cause:r}){return e.isInstance(r)&&r.value===t?r:new e({value:t,cause:r})}},Q="AI_UnsupportedFunctionalityError",X=`vercel.ai.error.${Q}`,ee=Symbol.for(X);var te=r(58833);r(83454);var re=(({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:a="-"}={})=>{const n=((e,t=21)=>(r=t)=>{let a="",n=0|r;for(;n--;)a+=e[Math.random()*e.length|0];return a})(r,t);if(null==e)return n;if(r.includes(a))throw new _({argument:"separator",message:`The separator "${a}" must not be part of the alphabet "${r}".`});return t=>`${e}${a}${n(t)}`})();var ae=Symbol.for("vercel.ai.validator");function ne(e){return function(e){return"object"===typeof e&&null!==e&&ae in e&&!0===e[ae]&&"validate"in e}(e)?e:function(e){return t=t=>{const r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}},{[ae]:!0,validate:t};var t}(e)}function oe({value:e,schema:t}){const r=ne(t);try{if(null==r.validate)return{success:!0,value:e};const t=r.validate(e);return t.success?t:{success:!1,error:z.wrap({value:e,cause:t.error})}}catch(a){return{success:!1,error:z.wrap({value:e,cause:a})}}}function se({text:e,schema:t}){try{const r=te.parse(e);if(null==t)return{success:!0,value:r,rawValue:r};const a=oe({value:r,schema:t});return a.success?{...a,rawValue:r}:a}catch(r){return{success:!1,error:N.isInstance(r)?r:new N({text:e,cause:r})}}}var{btoa:ie,atob:le}=globalThis;Symbol("Let zodToJsonSchema decide on which parser to use");new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");var ce={code:"0",name:"text",parse:e=>{if("string"!==typeof e)throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},ue={code:"3",name:"error",parse:e=>{if("string"!==typeof e)throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},pe={code:"4",name:"assistant_message",parse:e=>{if(null==e||"object"!==typeof e||!("id"in e)||!("role"in e)||!("content"in e)||"string"!==typeof e.id||"string"!==typeof e.role||"assistant"!==e.role||!Array.isArray(e.content)||!e.content.every((e=>null!=e&&"object"===typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"===typeof e.text&&"value"in e.text&&"string"===typeof e.text.value)))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},de={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!==typeof e||!("threadId"in e)||!("messageId"in e)||"string"!==typeof e.threadId||"string"!==typeof e.messageId)throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},fe={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!==typeof e||!("role"in e)||!("data"in e)||"string"!==typeof e.role||"data"!==e.role)throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},ge=[ce,ue,pe,de,fe];ge.map((e=>e.code));function he(e){const t=["ROOT"];let r=-1,a=null;function n(e,n,o){switch(e){case'"':r=n,t.pop(),t.push(o),t.push("INSIDE_STRING");break;case"f":case"t":case"n":r=n,a=n,t.pop(),t.push(o),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(o),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=n,t.pop(),t.push(o),t.push("INSIDE_NUMBER");break;case"{":r=n,t.pop(),t.push(o),t.push("INSIDE_OBJECT_START");break;case"[":r=n,t.pop(),t.push(o),t.push("INSIDE_ARRAY_START")}}function o(e,a){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":r=a,t.pop()}}function s(e,a){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=a,t.pop()}}for(let l=0;l<e.length;l++){const i=e[l];switch(t[t.length-1]){case"ROOT":n(i,l,"FINISH");break;case"INSIDE_OBJECT_START":switch(i){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":r=l,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":if('"'===i)t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"INSIDE_OBJECT_KEY":if('"'===i)t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY");break;case"INSIDE_OBJECT_AFTER_KEY":if(":"===i)t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE");break;case"INSIDE_OBJECT_BEFORE_VALUE":n(i,l,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":o(i,l);break;case"INSIDE_STRING":switch(i){case'"':t.pop(),r=l;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:r=l}break;case"INSIDE_ARRAY_START":if("]"===i)r=l,t.pop();else r=l,n(i,l,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_ARRAY_AFTER_VALUE":switch(i){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=l,t.pop();break;default:r=l}break;case"INSIDE_ARRAY_AFTER_COMMA":n(i,l,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),r=l;break;case"INSIDE_NUMBER":switch(i){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=l;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&s(i,l),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&o(i,l);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&o(i,l);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&s(i,l);break;default:t.pop()}break;case"INSIDE_LITERAL":{const n=e.substring(a,l+1);"false".startsWith(n)||"true".startsWith(n)||"null".startsWith(n)?r=l:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?o(i,l):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&s(i,l));break}}}let i=e.slice(0,r+1);for(let l=t.length-1;l>=0;l--){switch(t[l]){case"INSIDE_STRING":i+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":i+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":i+="]";break;case"INSIDE_LITERAL":{const t=e.substring(a,e.length);"true".startsWith(t)?i+="true".slice(t.length):"false".startsWith(t)?i+="false".slice(t.length):"null".startsWith(t)&&(i+="null".slice(t.length))}}}return i}var me=[{code:"0",name:"text",parse:e=>{if("string"!==typeof e)throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},{code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw new Error('"data" parts expect an array value.');return{type:"data",value:e}}},{code:"3",name:"error",parse:e=>{if("string"!==typeof e)throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},{code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},{code:"9",name:"tool_call",parse:e=>{if(null==e||"object"!==typeof e||!("toolCallId"in e)||"string"!==typeof e.toolCallId||!("toolName"in e)||"string"!==typeof e.toolName||!("args"in e)||"object"!==typeof e.args)throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},{code:"a",name:"tool_result",parse:e=>{if(null==e||"object"!==typeof e||!("toolCallId"in e)||"string"!==typeof e.toolCallId||!("result"in e))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},{code:"b",name:"tool_call_streaming_start",parse:e=>{if(null==e||"object"!==typeof e||!("toolCallId"in e)||"string"!==typeof e.toolCallId||!("toolName"in e)||"string"!==typeof e.toolName)throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},{code:"c",name:"tool_call_delta",parse:e=>{if(null==e||"object"!==typeof e||!("toolCallId"in e)||"string"!==typeof e.toolCallId||!("argsTextDelta"in e)||"string"!==typeof e.argsTextDelta)throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},{code:"d",name:"finish_message",parse:e=>{if(null==e||"object"!==typeof e||!("finishReason"in e)||"string"!==typeof e.finishReason)throw new Error('"finish_message" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason};return"usage"in e&&null!=e.usage&&"object"===typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"===typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"===typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},{code:"e",name:"finish_step",parse:e=>{if(null==e||"object"!==typeof e||!("finishReason"in e)||"string"!==typeof e.finishReason)throw new Error('"finish_step" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&null!=e.usage&&"object"===typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"===typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"===typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&"boolean"===typeof e.isContinued&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},{code:"f",name:"start_step",parse:e=>{if(null==e||"object"!==typeof e||!("messageId"in e)||"string"!==typeof e.messageId)throw new Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:e.messageId}}}},{code:"g",name:"reasoning",parse:e=>{if("string"!==typeof e)throw new Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:e}}},{code:"h",name:"source",parse:e=>{if(null==e||"object"!==typeof e)throw new Error('"source" parts expect a Source object.');return{type:"source",value:e}}},{code:"i",name:"redacted_reasoning",parse:e=>{if(null==e||"object"!==typeof e||!("data"in e)||"string"!==typeof e.data)throw new Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:e.data}}}},{code:"j",name:"reasoning_signature",parse:e=>{if(null==e||"object"!==typeof e||!("signature"in e)||"string"!==typeof e.signature)throw new Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:e.signature}}}},{code:"k",name:"file",parse:e=>{if(null==e||"object"!==typeof e||!("data"in e)||"string"!==typeof e.data||!("mimeType"in e)||"string"!==typeof e.mimeType)throw new Error('"file" parts expect an object with a "data" and "mimeType" property.');return{type:"file",value:e}}}],ye=Object.fromEntries(me.map((e=>[e.code,e]))),ve=(Object.fromEntries(me.map((e=>[e.name,e.code]))),me.map((e=>e.code))),Ee=e=>{const t=e.indexOf(":");if(-1===t)throw new Error("Failed to parse stream string. No separator found.");const r=e.slice(0,t);if(!ve.includes(r))throw new Error(`Failed to parse stream string. Invalid code ${r}.`);const a=r,n=e.slice(t+1),o=JSON.parse(n);return ye[a].parse(o)};var _e="\n".charCodeAt(0);function be(e,t){const r=new Uint8Array(t);let a=0;for(const n of e)r.set(n,a),a+=n.length;return e.length=0,r}async function Ie({stream:e,onTextPart:t,onReasoningPart:r,onReasoningSignaturePart:a,onRedactedReasoningPart:n,onSourcePart:o,onFilePart:s,onDataPart:i,onErrorPart:l,onToolCallStreamingStartPart:c,onToolCallDeltaPart:u,onToolCallPart:p,onToolResultPart:d,onMessageAnnotationsPart:f,onFinishMessagePart:g,onFinishStepPart:h,onStartStepPart:m}){const y=e.getReader(),v=new TextDecoder,E=[];let _=0;for(;;){const{value:e}=await y.read();if(e&&(E.push(e),_+=e.length,e[e.length-1]!==_e))continue;if(0===E.length)break;const b=be(E,_);_=0;const I=v.decode(b,{stream:!0}).split("\n").filter((e=>""!==e)).map(Ee);for(const{type:y,value:v}of I)switch(y){case"text":await(null==t?void 0:t(v));break;case"reasoning":await(null==r?void 0:r(v));break;case"reasoning_signature":await(null==a?void 0:a(v));break;case"redacted_reasoning":await(null==n?void 0:n(v));break;case"file":await(null==s?void 0:s(v));break;case"source":await(null==o?void 0:o(v));break;case"data":await(null==i?void 0:i(v));break;case"error":await(null==l?void 0:l(v));break;case"message_annotations":await(null==f?void 0:f(v));break;case"tool_call_streaming_start":await(null==c?void 0:c(v));break;case"tool_call_delta":await(null==u?void 0:u(v));break;case"tool_call":await(null==p?void 0:p(v));break;case"tool_result":await(null==d?void 0:d(v));break;case"finish_message":await(null==g?void 0:g(v));break;case"finish_step":await(null==h?void 0:h(v));break;case"start_step":await(null==m?void 0:m(v));break;default:throw new Error(`Unknown stream part type: ${y}`)}}}async function we({stream:e,update:t,onToolCall:r,onFinish:a,generateId:n=re,getCurrentDate:o=(()=>new Date),lastMessage:s}){var i,l;const c="assistant"===(null==s?void 0:s.role);let u=c?1+(null!=(l=null==(i=s.toolInvocations)?void 0:i.reduce(((e,t)=>{var r;return Math.max(e,null!=(r=t.step)?r:0)}),0))?l:0):0;const p=c?structuredClone(s):{id:n(),createdAt:o(),role:"assistant",content:"",parts:[]};let d,f,g;function h(e,t){const r=p.parts.find((t=>"tool-invocation"===t.type&&t.toolInvocation.toolCallId===e));null!=r?r.toolInvocation=t:p.parts.push({type:"tool-invocation",toolInvocation:t})}const m=[];let y=c?null==s?void 0:s.annotations:void 0;const v={};let E={completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},_="unknown";function b(){const e=[...m];(null==y?void 0:y.length)&&(p.annotations=y);const r={...structuredClone(p),revisionId:n()};t({message:r,data:e,replaceLastMessage:c})}await Ie({stream:e,onTextPart(e){null==d?(d={type:"text",text:e},p.parts.push(d)):d.text+=e,p.content+=e,b()},onReasoningPart(e){var t;null==g?(g={type:"text",text:e},null!=f&&f.details.push(g)):g.text+=e,null==f?(f={type:"reasoning",reasoning:e,details:[g]},p.parts.push(f)):f.reasoning+=e,p.reasoning=(null!=(t=p.reasoning)?t:"")+e,b()},onReasoningSignaturePart(e){null!=g&&(g.signature=e.signature)},onRedactedReasoningPart(e){null==f&&(f={type:"reasoning",reasoning:"",details:[]},p.parts.push(f)),f.details.push({type:"redacted",data:e.data}),g=void 0,b()},onFilePart(e){p.parts.push({type:"file",mimeType:e.mimeType,data:e.data}),b()},onSourcePart(e){p.parts.push({type:"source",source:e}),b()},onToolCallStreamingStartPart(e){null==p.toolInvocations&&(p.toolInvocations=[]),v[e.toolCallId]={text:"",step:u,toolName:e.toolName,index:p.toolInvocations.length};const t={state:"partial-call",step:u,toolCallId:e.toolCallId,toolName:e.toolName,args:void 0};p.toolInvocations.push(t),h(e.toolCallId,t),b()},onToolCallDeltaPart(e){const t=v[e.toolCallId];t.text+=e.argsTextDelta;const{value:r}=function(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=se({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=se({text:he(e)}),t.success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}(t.text),a={state:"partial-call",step:t.step,toolCallId:e.toolCallId,toolName:t.toolName,args:r};p.toolInvocations[t.index]=a,h(e.toolCallId,a),b()},async onToolCallPart(e){const t={state:"call",step:u,...e};if(null!=v[e.toolCallId]?p.toolInvocations[v[e.toolCallId].index]=t:(null==p.toolInvocations&&(p.toolInvocations=[]),p.toolInvocations.push(t)),h(e.toolCallId,t),b(),r){const t=await r({toolCall:e});if(null!=t){const r={state:"result",step:u,...e,result:t};p.toolInvocations[p.toolInvocations.length-1]=r,h(e.toolCallId,r),b()}}},onToolResultPart(e){const t=p.toolInvocations;if(null==t)throw new Error("tool_result must be preceded by a tool_call");const r=t.findIndex((t=>t.toolCallId===e.toolCallId));if(-1===r)throw new Error("tool_result must be preceded by a tool_call with the same toolCallId");const a={...t[r],state:"result",...e};t[r]=a,h(e.toolCallId,a),b()},onDataPart(e){m.push(...e),b()},onMessageAnnotationsPart(e){null==y?y=[...e]:y.push(...e),b()},onFinishStepPart(e){u+=1,d=e.isContinued?d:void 0,f=void 0,g=void 0},onStartStepPart(e){c||(p.id=e.messageId),p.parts.push({type:"step-start"}),b()},onFinishMessagePart(e){_=e.finishReason,null!=e.usage&&(E=function({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}(e.usage))},onErrorPart(e){throw new Error(e)}}),null==a||a({message:p,finishReason:_,usage:E})}async function Te({stream:e,onTextPart:t}){const r=e.pipeThrough(new TextDecoderStream).getReader();for(;;){const{done:e,value:a}=await r.read();if(e)break;await t(a)}}var Se=()=>fetch;async function Re({api:e,body:t,streamProtocol:r="data",credentials:a,headers:n,abortController:o,restoreMessagesOnFailure:s,onResponse:i,onUpdate:l,onFinish:c,onToolCall:u,generateId:p,fetch:d=Se(),lastMessage:f,requestType:g="generate"}){var h,m,y;const v="resume"===g?d(`${e}?chatId=${t.id}`,{method:"GET",headers:{"Content-Type":"application/json",...n},signal:null==(h=null==o?void 0:o())?void 0:h.signal,credentials:a}):d(e,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",...n},signal:null==(m=null==o?void 0:o())?void 0:m.signal,credentials:a}),E=await v.catch((e=>{throw s(),e}));if(i)try{await i(E)}catch(_){throw _}if(!E.ok)throw s(),new Error(null!=(y=await E.text())?y:"Failed to fetch the chat response.");if(!E.body)throw new Error("The response body is empty.");switch(r){case"text":return void(await async function({stream:e,update:t,onFinish:r,getCurrentDate:a=(()=>new Date),generateId:n=re}){const o={type:"text",text:""},s={id:n(),createdAt:a(),role:"assistant",content:"",parts:[o]};await Te({stream:e,onTextPart:e=>{s.content+=e,o.text+=e,t({message:{...s},data:[],replaceLastMessage:!1})}}),null==r||r(s,{usage:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},finishReason:"unknown"})}({stream:E.body,update:l,onFinish:c,generateId:p}));case"data":return void(await we({stream:E.body,update:l,lastMessage:f,onToolCall:u,onFinish({message:e,finishReason:t,usage:r}){c&&null!=e&&c(e,{usage:r,finishReason:t})},generateId:p}));default:throw new Error(`Unknown stream protocol: ${r}`)}}function Ae(e){return null==e?void 0:e.reduce(((e,t)=>{var r;return Math.max(e,null!=(r=t.step)?r:0)}),0)}function ke(e){var t;return null!=(t=e.parts)?t:[...e.toolInvocations?e.toolInvocations.map((e=>({type:"tool-invocation",toolInvocation:e}))):[],...e.reasoning?[{type:"reasoning",reasoning:e.reasoning,details:[{type:"text",text:e.reasoning}]}]:[],...e.content?[{type:"text",text:e.content}]:[]]}function Ce(e){return e.map((e=>({...e,parts:ke(e)})))}function xe(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if("object"!==typeof e&&"object"!==typeof t)return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(Array.isArray(e)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!xe(e[r],t[r]))return!1;return!0}const r=Object.keys(e),a=Object.keys(t);if(r.length!==a.length)return!1;for(const n of r){if(!a.includes(n))return!1;if(!xe(e[n],t[n]))return!1}return!0}async function Ne(e){if(!e)return[];if(globalThis.FileList&&e instanceof globalThis.FileList)return Promise.all(Array.from(e).map((async e=>{const{name:t,type:r}=e,a=await new Promise(((t,r)=>{const a=new FileReader;a.onload=e=>{var r;t(null==(r=e.target)?void 0:r.result)},a.onerror=e=>r(e),a.readAsDataURL(e)}));return{name:t,contentType:r,url:a}})));if(Array.isArray(e))return e;throw new Error("Invalid attachments type")}"\n".charCodeAt(0);Symbol.for("vercel.ai.schema");function Oe(e){if("assistant"!==e.role)return!1;const t=e.parts.reduce(((e,t,r)=>"step-start"===t.type?r:e),-1),r=e.parts.slice(t+1).filter((e=>"tool-invocation"===e.type));return r.length>0&&r.every((e=>"result"in e.toolInvocation))}var De=r(98557);var je=Object.prototype.hasOwnProperty;const Fe=new WeakMap,Pe=()=>{},Le=Pe(),Me=Object,Ve=e=>e===Le,$e=e=>"function"==typeof e,Be=(e,t)=>({...e,...t}),Je=e=>$e(e.then),Ue={},Ye={},We="undefined",qe=typeof window!=We,Ke=typeof document!=We,Ge=qe&&"Deno"in window,Ze=(e,t)=>{const r=Fe.get(e);return[()=>!Ve(t)&&e.get(t)||Ue,a=>{if(!Ve(t)){const n=e.get(t);t in Ye||(Ye[t]=n),r[5](t,Be(n,a),n||Ue)}},r[6],()=>!Ve(t)&&t in Ye?Ye[t]:!Ve(t)&&e.get(t)||Ue]};let He=!0;const[ze,Qe]=qe&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[Pe,Pe],Xe={isOnline:()=>He,isVisible:()=>{const e=Ke&&document.visibilityState;return Ve(e)||"hidden"!==e}},et={initFocus:e=>(Ke&&document.addEventListener("visibilitychange",e),ze("focus",e),()=>{Ke&&document.removeEventListener("visibilitychange",e),Qe("focus",e)}),initReconnect:e=>{const t=()=>{He=!0,e()},r=()=>{He=!1};return ze("online",t),ze("offline",r),()=>{Qe("online",t),Qe("offline",r)}}},tt=!n.useId,rt=!qe||Ge,at=e=>qe&&typeof window.requestAnimationFrame!=We?window.requestAnimationFrame(e):setTimeout(e,1),nt=rt?n.useEffect:n.useLayoutEffect,ot="undefined"!==typeof navigator&&navigator.connection,st=!rt&&ot&&(["slow-2g","2g"].includes(ot.effectiveType)||ot.saveData),it=new WeakMap,lt=(e,t)=>e===`[object ${t}]`;let ct=0;const ut=e=>{const t=typeof e,r=(a=e,Me.prototype.toString.call(a));var a;const n=lt(r,"Date"),o=lt(r,"RegExp"),s=lt(r,"Object");let i,l;if(Me(e)!==e||n||o)i=n?e.toJSON():"symbol"==t?e.toString():"string"==t?JSON.stringify(e):""+e;else{if(i=it.get(e),i)return i;if(i=++ct+"~",it.set(e,i),Array.isArray(e)){for(i="@",l=0;l<e.length;l++)i+=ut(e[l])+",";it.set(e,i)}if(s){i="#";const t=Me.keys(e).sort();for(;!Ve(l=t.pop());)Ve(e[l])||(i+=l+":"+ut(e[l])+",");it.set(e,i)}}return i},pt=e=>{if($e(e))try{e=e()}catch(r){e=""}const t=e;return[e="string"==typeof e?e:(Array.isArray(e)?e.length:e)?ut(e):"",t]};let dt=0;const ft=()=>++dt;async function gt(...e){const[t,r,a,n]=e,o=Be({populateCache:!0,throwOnError:!0},"boolean"===typeof n?{revalidate:n}:n||{});let s=o.populateCache;const i=o.rollbackOnError;let l=o.optimisticData;const c=o.throwOnError;if($e(r)){const e=r,a=[],n=t.keys();for(const r of n)!/^\$(inf|sub)\$/.test(r)&&e(t.get(r)._k)&&a.push(r);return Promise.all(a.map(u))}return u(r);async function u(r){const[n]=pt(r);if(!n)return;const[u,p]=Ze(t,n),[d,f,g,h]=Fe.get(t),m=()=>{const e=d[n];return($e(o.revalidate)?o.revalidate(u().data,r):!1!==o.revalidate)&&(delete g[n],delete h[n],e&&e[0])?e[0](2).then((()=>u().data)):u().data};if(e.length<3)return m();let y,v=a,E=!1;const _=ft();f[n]=[_,0];const b=!Ve(l),I=u(),w=I.data,T=I._c,S=Ve(T)?w:T;if(b&&(l=$e(l)?l(S,w):l,p({data:l,_c:S})),$e(v))try{v=v(S)}catch(R){y=R,E=!0}if(v&&Je(v)){if(v=await v.catch((e=>{y=e,E=!0})),_!==f[n][0]){if(E)throw y;return v}E&&b&&(e=>"function"===typeof i?i(e):!1!==i)(y)&&(s=!0,p({data:S,_c:Le}))}if(s&&!E)if($e(s)){const e=s(v,S);p({data:e,error:Le,_c:Le})}else p({data:v,error:Le,_c:Le});if(f[n][1]=ft(),Promise.resolve(m()).then((()=>{p({_c:Le})})),!E)return v;if(c)throw y}}const ht=(e,t)=>{for(const r in e)e[r][0]&&e[r][0](t)},mt=(e,t)=>{if(!Fe.has(e)){const r=Be(et,t),a=Object.create(null),n=gt.bind(Le,e);let o=Pe;const s=Object.create(null),i=(e,t)=>{const r=s[e]||[];return s[e]=r,r.push(t),()=>r.splice(r.indexOf(t),1)},l=(t,r,a)=>{e.set(t,r);const n=s[t];if(n)for(const e of n)e(r,a)},c=()=>{if(!Fe.has(e)&&(Fe.set(e,[a,Object.create(null),Object.create(null),Object.create(null),n,l,i]),!rt)){const t=r.initFocus(setTimeout.bind(Le,ht.bind(Le,a,0))),n=r.initReconnect(setTimeout.bind(Le,ht.bind(Le,a,1)));o=()=>{t&&t(),n&&n(),Fe.delete(e)}}};return c(),[e,n,c,o]}return[e,Fe.get(e)[4]]},yt=function e(t,r){var a,n;if(t===r)return!0;if(t&&r&&(a=t.constructor)===r.constructor){if(a===Date)return t.getTime()===r.getTime();if(a===RegExp)return t.toString()===r.toString();if(a===Array){if((n=t.length)===r.length)for(;n--&&e(t[n],r[n]););return-1===n}if(!a||"object"===typeof t){for(a in n=0,t){if(je.call(t,a)&&++n&&!je.call(r,a))return!1;if(!(a in r)||!e(t[a],r[a]))return!1}return Object.keys(r).length===n}}return t!==t&&r!==r},[vt,Et]=mt(new Map),_t=Be({onLoadingSlow:Pe,onSuccess:Pe,onError:Pe,onErrorRetry:(e,t,r,a,n)=>{const o=r.errorRetryCount,s=n.retryCount,i=~~((Math.random()+.5)*(1<<(s<8?s:8)))*r.errorRetryInterval;!Ve(o)&&s>o||setTimeout(a,i,n)},onDiscarded:Pe,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:st?1e4:5e3,focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:st?5e3:3e3,compare:yt,isPaused:()=>!1,cache:vt,mutate:Et,fallback:{}},Xe),bt=(e,t)=>{const r=Be(e,t);if(t){const{use:a,fallback:n}=e,{use:o,fallback:s}=t;a&&o&&(r.use=a.concat(o)),n&&s&&(r.fallback=Be(n,s))}return r},It=(0,n.createContext)({}),wt=qe&&window.__SWR_DEVTOOLS_USE__,Tt=wt?window.__SWR_DEVTOOLS_USE__:[],St=e=>$e(e[1])?[e[0],e[1],e[2]||{}]:[e[0],null,(null===e[1]?e[2]:e[1])||{}],Rt=Tt.concat((e=>(t,r,a)=>e(t,r&&((...e)=>{const[a]=pt(t),[,,,n]=Fe.get(vt);if(a.startsWith("$inf$"))return r(...e);const o=n[a];return Ve(o)?r(...e):(delete n[a],o)}),a)));wt&&(window.__SWR_DEVTOOLS_REACT__=n);const At=()=>{};At(),new WeakMap;const kt=n.use||(e=>{switch(e.status){case"pending":throw e;case"fulfilled":return e.value;case"rejected":throw e.reason;default:throw e.status="pending",e.then((t=>{e.status="fulfilled",e.value=t}),(t=>{e.status="rejected",e.reason=t})),e}}),Ct={dedupe:!0},xt=(Me.defineProperty((e=>{const{value:t}=e,r=(0,n.useContext)(It),a=$e(t),o=(0,n.useMemo)((()=>a?t(r):t),[a,r,t]),s=(0,n.useMemo)((()=>a?o:bt(r,o)),[a,r,o]),i=o&&o.provider,l=(0,n.useRef)(Le);i&&!l.current&&(l.current=mt(i(s.cache||vt),o));const c=l.current;return c&&(s.cache=c[0],s.mutate=c[1]),nt((()=>{if(c)return c[2]&&c[2](),c[3]}),[]),(0,n.createElement)(It.Provider,Be(e,{value:s}))}),"defaultValue",{value:_t}),Nt=(e,t,r)=>{const{cache:a,compare:o,suspense:s,fallbackData:i,revalidateOnMount:l,revalidateIfStale:c,refreshInterval:u,refreshWhenHidden:p,refreshWhenOffline:d,keepPreviousData:f}=r,[g,h,m,y]=Fe.get(a),[v,E]=pt(e),_=(0,n.useRef)(!1),b=(0,n.useRef)(!1),I=(0,n.useRef)(v),w=(0,n.useRef)(t),T=(0,n.useRef)(r),S=()=>T.current,R=()=>S().isVisible()&&S().isOnline(),[A,k,C,x]=Ze(a,v),N=(0,n.useRef)({}).current,O=Ve(i)?Ve(r.fallback)?Le:r.fallback[v]:i,D=(e,t)=>{for(const r in N){const a=r;if("data"===a){if(!o(e[a],t[a])){if(!Ve(e[a]))return!1;if(!o(J,t[a]))return!1}}else if(t[a]!==e[a])return!1}return!0},j=(0,n.useMemo)((()=>{const e=!!v&&!!t&&(Ve(l)?!S().isPaused()&&!s&&!1!==c:l),r=t=>{const r=Be(t);return delete r._k,e?{isValidating:!0,isLoading:!0,...r}:r},a=A(),n=x(),o=r(a),i=a===n?o:r(n);let u=o;return[()=>{const e=r(A());return D(e,u)?(u.data=e.data,u.isLoading=e.isLoading,u.isValidating=e.isValidating,u.error=e.error,u):(u=e,e)},()=>i]}),[a,v]),F=(0,De.useSyncExternalStore)((0,n.useCallback)((e=>C(v,((t,r)=>{D(r,t)||e()}))),[a,v]),j[0],j[1]),P=!_.current,L=g[v]&&g[v].length>0,M=F.data,V=Ve(M)?O&&Je(O)?kt(O):O:M,$=F.error,B=(0,n.useRef)(V),J=f?Ve(M)?Ve(B.current)?V:B.current:M:V,U=!(L&&!Ve($))&&(P&&!Ve(l)?l:!S().isPaused()&&(s?!Ve(V)&&c:Ve(V)||c)),Y=!!(v&&t&&P&&U),W=Ve(F.isValidating)?Y:F.isValidating,q=Ve(F.isLoading)?Y:F.isLoading,K=(0,n.useCallback)((async e=>{const t=w.current;if(!v||!t||b.current||S().isPaused())return!1;let a,n,s=!0;const i=e||{},l=!m[v]||!i.dedupe,c=()=>tt?!b.current&&v===I.current&&_.current:v===I.current,u={isValidating:!1,isLoading:!1},p=()=>{k(u)},d=()=>{const e=m[v];e&&e[1]===n&&delete m[v]},f={isValidating:!0};Ve(A().data)&&(f.isLoading=!0);try{if(l&&(k(f),r.loadingTimeout&&Ve(A().data)&&setTimeout((()=>{s&&c()&&S().onLoadingSlow(v,r)}),r.loadingTimeout),m[v]=[t(E),ft()]),[a,n]=m[v],a=await a,l&&setTimeout(d,r.dedupingInterval),!m[v]||m[v][1]!==n)return l&&c()&&S().onDiscarded(v),!1;u.error=Le;const e=h[v];if(!Ve(e)&&(n<=e[0]||n<=e[1]||0===e[1]))return p(),l&&c()&&S().onDiscarded(v),!1;const i=A().data;u.data=o(i,a)?i:a,l&&c()&&S().onSuccess(a,v,r)}catch(y){d();const e=S(),{shouldRetryOnError:t}=e;e.isPaused()||(u.error=y,l&&c()&&(e.onError(y,v,e),(!0===t||$e(t)&&t(y))&&(S().revalidateOnFocus&&S().revalidateOnReconnect&&!R()||e.onErrorRetry(y,v,e,(e=>{const t=g[v];t&&t[0]&&t[0](3,e)}),{retryCount:(i.retryCount||0)+1,dedupe:!0}))))}return s=!1,p(),!0}),[v,a]),G=(0,n.useCallback)(((...e)=>gt(a,I.current,...e)),[]);if(nt((()=>{w.current=t,T.current=r,Ve(M)||(B.current=M)})),nt((()=>{if(!v)return;const e=K.bind(Le,Ct);let t=0;if(S().revalidateOnFocus){const e=Date.now();t=e+S().focusThrottleInterval}const r=((e,t,r)=>{const a=t[e]||(t[e]=[]);return a.push(r),()=>{const e=a.indexOf(r);e>=0&&(a[e]=a[a.length-1],a.pop())}})(v,g,((r,a={})=>{if(0==r){const r=Date.now();S().revalidateOnFocus&&r>t&&R()&&(t=r+S().focusThrottleInterval,e())}else if(1==r)S().revalidateOnReconnect&&R()&&e();else{if(2==r)return K();if(3==r)return K(a)}}));return b.current=!1,I.current=v,_.current=!0,k({_k:E}),U&&(m[v]||(Ve(V)||rt?e():at(e))),()=>{b.current=!0,r()}}),[v]),nt((()=>{let e;function t(){const t=$e(u)?u(A().data):u;t&&-1!==e&&(e=setTimeout(r,t))}function r(){A().error||!p&&!S().isVisible()||!d&&!S().isOnline()?t():K(Ct).then(t)}return t(),()=>{e&&(clearTimeout(e),e=-1)}}),[u,p,d,v]),(0,n.useDebugValue)(J),s&&Ve(V)&&v){if(!tt&&rt)throw new Error("Fallback data is required when using Suspense in SSR.");w.current=t,T.current=r,b.current=!1;const e=y[v];if(!Ve(e)){const t=G(e);kt(t)}if(!Ve($))throw $;{const e=K(Ct);Ve(J)||(e.status="fulfilled",e.value=!0),kt(e)}}return{mutate:G,get data(){return N.data=!0,J},get error(){return N.error=!0,$},get isValidating(){return N.isValidating=!0,W},get isLoading(){return N.isLoading=!0,q}}},function(...e){const t=Be(_t,(0,n.useContext)(It)),[r,a,o]=St(e),s=bt(t,o);let i=Nt;const{use:l}=s,c=(l||[]).concat(Rt);for(let n=c.length;n--;)i=c[n](i);return i(r,a||s.fetcher||null,s)});var Nt,Ot=r(49623);function Dt(e,t){return null!=t?Ot(e,t):e}function jt(e){const[t,r]=(0,n.useState)(e);return(0,n.useEffect)((()=>{xe(e,t)||r(e)}),[e,t]),t}function Ft({api:e="/api/chat",id:t,initialMessages:r,initialInput:a="",sendExtraMessageFields:o,onToolCall:s,experimental_prepareRequestBody:i,maxSteps:l=1,streamProtocol:c="data",onResponse:u,onFinish:p,onError:d,credentials:f,headers:g,body:h,generateId:m=re,fetch:y,keepLastMessageOnError:v=!0,experimental_throttle:E}={}){const[_]=(0,n.useState)(m),b=null!=t?t:_,I="string"===typeof e?[e,b]:b,w=jt(null!=r?r:[]),T=(0,n.useMemo)((()=>Ce(w)),[w]),{data:S,mutate:R}=xt([I,"messages"],null,{fallbackData:T}),A=(0,n.useRef)(S||[]);(0,n.useEffect)((()=>{A.current=S||[]}),[S]);const{data:k,mutate:C}=xt([I,"streamData"],null),x=(0,n.useRef)(k);(0,n.useEffect)((()=>{x.current=k}),[k]);const{data:N="ready",mutate:O}=xt([I,"status"],null),{data:D,mutate:j}=xt([I,"error"],null),F=(0,n.useRef)(null),P=(0,n.useRef)({credentials:f,headers:g,body:h});(0,n.useEffect)((()=>{P.current={credentials:f,headers:g,body:h}}),[f,g,h]);const L=(0,n.useCallback)((async(t,r="generate")=>{var a,n;O("submitted"),j(void 0);const f=Ce(t.messages),g=f.length,h=Ae(null==(a=f[f.length-1])?void 0:a.toolInvocations);try{const a=new AbortController;F.current=a;const l=Dt(R,E),d=Dt(C,E),g=A.current;l(f,!1);const h=o?f:f.map((({role:e,content:t,experimental_attachments:r,data:a,annotations:n,toolInvocations:o,parts:s})=>({role:e,content:t,...void 0!==r&&{experimental_attachments:r},...void 0!==a&&{data:a},...void 0!==n&&{annotations:n},...void 0!==o&&{toolInvocations:o},...void 0!==s&&{parts:s}}))),_=x.current;await Re({api:e,body:null!=(n=null==i?void 0:i({id:b,messages:f,requestData:t.data,requestBody:t.body}))?n:{id:b,messages:h,data:t.data,...P.current.body,...t.body},streamProtocol:c,credentials:P.current.credentials,headers:{...P.current.headers,...t.headers},abortController:()=>F.current,restoreMessagesOnFailure(){v||l(g,!1)},onResponse:u,onUpdate({message:e,data:t,replaceLastMessage:r}){O("streaming"),l([...r?f.slice(0,f.length-1):f,e],!1),(null==t?void 0:t.length)&&d([...null!=_?_:[],...t],!1)},onToolCall:s,onFinish:p,generateId:m,fetch:y,lastMessage:f[f.length-1],requestType:r}),F.current=null,O("ready")}catch(I){if("AbortError"===I.name)return F.current=null,O("ready"),null;d&&I instanceof Error&&d(I),j(I),O("error")}const _=A.current;(function({originalMaxToolInvocationStep:e,originalMessageCount:t,maxSteps:r,messages:a}){var n;const o=a[a.length-1];return r>1&&null!=o&&(a.length>t||Ae(o.toolInvocations)!==e)&&Oe(o)&&(null!=(n=Ae(o.toolInvocations))?n:0)<r})({originalMaxToolInvocationStep:h,originalMessageCount:g,maxSteps:l,messages:_})&&await L({messages:_})}),[R,O,e,P,u,p,d,j,C,x,c,o,i,s,l,A,F,m,y,v,E,b]),M=(0,n.useCallback)((async(e,{data:t,headers:r,body:a,experimental_attachments:n=e.experimental_attachments}={})=>{var o,s;const i=await Ne(n),l=A.current.concat({...e,id:null!=(o=e.id)?o:m(),createdAt:null!=(s=e.createdAt)?s:new Date,experimental_attachments:i.length>0?i:void 0,parts:ke(e)});return L({messages:l,headers:r,body:a,data:t})}),[L,m]),V=(0,n.useCallback)((async({data:e,headers:t,body:r}={})=>{const a=A.current;if(0===a.length)return null;const n=a[a.length-1];return L({messages:"assistant"===n.role?a.slice(0,-1):a,headers:t,body:r,data:e})}),[L]),$=(0,n.useCallback)((()=>{F.current&&(F.current.abort(),F.current=null)}),[]),B=(0,n.useCallback)((async()=>{const e=A.current;L({messages:e},"resume")}),[L]),J=(0,n.useCallback)((e=>{"function"===typeof e&&(e=e(A.current));const t=Ce(e);R(t,!1),A.current=t}),[R]),U=(0,n.useCallback)((e=>{"function"===typeof e&&(e=e(x.current)),C(e,!1),x.current=e}),[C]),[Y,W]=(0,n.useState)(a),q=(0,n.useCallback)((async(e,t={},r)=>{var a;if(null==(a=null==e?void 0:e.preventDefault)||a.call(e),!Y&&!t.allowEmptySubmit)return;r&&(P.current={...P.current,...r});const n=await Ne(t.experimental_attachments),o={messages:A.current.concat({id:m(),createdAt:new Date,role:"user",content:Y,experimental_attachments:n.length>0?n:void 0,parts:[{type:"text",text:Y}]}),headers:t.headers,body:t.body,data:t.data};L(o),W("")}),[Y,m,L]),K=(0,n.useCallback)((({toolCallId:e,result:t})=>{const r=A.current;if(function({messages:e,toolCallId:t,toolResult:r}){var a;const n=e[e.length-1],o=n.parts.find((e=>"tool-invocation"===e.type&&e.toolInvocation.toolCallId===t));if(null==o)return;const s={...o.toolInvocation,state:"result",result:r};o.toolInvocation=s,n.toolInvocations=null==(a=n.toolInvocations)?void 0:a.map((e=>e.toolCallId===t?s:e))}({messages:r,toolCallId:e,toolResult:t}),R([...r.slice(0,r.length-1),{...r[r.length-1]}],!1),"submitted"===N||"streaming"===N)return;Oe(r[r.length-1])&&L({messages:r})}),[R,N,L]);return{messages:null!=S?S:[],id:b,setMessages:J,data:k,setData:U,error:D,append:M,reload:V,stop:$,experimental_resume:B,input:Y,setInput:W,handleInputChange:e=>{W(e.target.value)},handleSubmit:q,isLoading:"submitted"===N||"streaming"===N,status:N,addToolResult:K}}}}]);